<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Hot Wheels â€“ Mi ColecciÃ³n</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .car { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    button { margin-right: 5px; }
    form { margin-top: 10px; }
    input, select { margin: 5px; }
  </style>
</head>
<body>
  <h1>Hot Wheels â€“ Mi ColecciÃ³n</h1>
  <div id="content"></div>
  <button onclick="addManual()">Agregar Auto de Ejemplo</button>

  <!-- ðŸ”‘ Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc } 
      from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // âš™ï¸ ConfiguraciÃ³n de tu proyecto Firebase
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_AUTH_DOMAIN",
      projectId: "TU_PROJECT_ID",
      storageBucket: "TU_STORAGE_BUCKET",
      messagingSenderId: "TU_SENDER_ID",
      appId: "TU_APP_ID"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const carsCol = collection(db, "cars");

    // ðŸ”¹ Escuchar cambios en tiempo real
    onSnapshot(carsCol, (snapshot) => {
      const cars = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderCars(cars);
    });

    // ðŸ”¹ Agregar auto de ejemplo
    window.addManual = async function() {
      const samples = [
        {name:"Ford Mustang", model:"Muscle Series", collection_type:"in_box"},
        {name:"Nissan Skyline", model:"JDM", collection_type:"no_box"},
        {name:"Porsche 911", model:"Exotics", collection_type:"wishlist"}
      ];
      const car = samples[Math.floor(Math.random()*samples.length)];
      await addDoc(carsCol, car);
    }

    // ðŸ”¹ Eliminar auto con confirmaciÃ³n
    window.deleteCar = async function(id) {
      const seguro = confirm("Â¿Seguro que quieres eliminar este auto? Esta acciÃ³n no se puede deshacer.");
      if(seguro){
        await deleteDoc(doc(db, "cars", id));
      }
    }

    // ðŸ”¹ Editar auto (formulario)
    window.showEditForm = function(id, car) {
      const formHtml = `
        <form onsubmit="submitEdit('${id}'); return false;">
          <input type="text" id="edit-name-${id}" value="${car.name}" placeholder="Nombre">
          <input type="text" id="edit-model-${id}" value="${car.model}" placeholder="Modelo">
          <select id="edit-state-${id}">
            <option value="in_box" ${car.collection_type==="in_box"?"selected":""}>En Caja</option>
            <option value="no_box" ${car.collection_type==="no_box"?"selected":""}>Sin Caja</option>
            <option value="wishlist" ${car.collection_type==="wishlist"?"selected":""}>Wishlist</option>
          </select>
          <button type="submit">Guardar</button>
        </form>
      `;
      document.getElementById("edit-"+id).innerHTML = formHtml;
    }

    window.submitEdit = async function(id) {
      const name = document.getElementById("edit-name-"+id).value;
      const model = document.getElementById("edit-model-"+id).value;
      const state = document.getElementById("edit-state-"+id).value;
      await updateDoc(doc(db, "cars", id), {
        name: name,
        model: model,
        collection_type: state
      });
      document.getElementById("edit-"+id).innerHTML = ""; // limpiar formulario
    }

    // ðŸ”¹ Renderizar autos en la pÃ¡gina
    function renderCars(cars) {
      document.getElementById("content").innerHTML =
        cars.map(c => `
          <div class="car">
            <strong>${c.name}</strong> (${c.model}) - <em>${c.collection_type}</em><br>
            <button onclick="deleteCar('${c.id}')">Eliminar</button>
            <button onclick="showEditForm('${c.id}', ${JSON.stringify(c)})">Editar</button>
            <div id="edit-${c.id}"></div>
          </div>
        `).join("");
    }
  </script>
</body>
</html>
